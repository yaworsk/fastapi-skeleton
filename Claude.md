# Claude AI Assistant Guide - FastAPI Skeleton Generator

This document provides comprehensive guidance for AI assistants (particularly Claude) working with the FastAPI Skeleton Generator and projects generated by it.

## ðŸŽ¯ Generator Overview

The FastAPI Skeleton Generator is a project creation tool similar to `rails new` that creates production-ready FastAPI applications with:
- **Backend**: FastAPI with clean MVC architecture
- **Frontend**: Vue.js 3 with Vite
- **Database**: PostgreSQL with Alembic migrations
- **Testing**: pytest with isolated test database
- **Code Quality**: Comprehensive linting and formatting
- **Containerization**: Docker Compose setup

## ðŸ—ï¸ Generator Structure

```
fastapi-skeleton/                # Generator repository
â”œâ”€â”€ fastapi-init                 # Main generator script
â”œâ”€â”€ skeleton/                    # Template files
â”‚   â”œâ”€â”€ backend/                 # FastAPI template
â”‚   â”œâ”€â”€ frontend/                # Vue.js template
â”‚   â”œâ”€â”€ postgres/                # Database setup
â”‚   â”œâ”€â”€ docker-compose.yml       # Templated with {{VARIABLES}}
â”‚   â”œâ”€â”€ .env.example             # Environment template
â”‚   â”œâ”€â”€ Makefile.template        # Templated Makefile
â”‚   â””â”€â”€ README.md.template       # Project documentation template
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ customize.py             # Template customization
â”‚   â””â”€â”€ validate.sh              # Validation functions
â”œâ”€â”€ README.md                    # Generator documentation
â””â”€â”€ Claude.md                    # This file
```

## ðŸš€ Using the Generator

### Basic Commands

```bash
# Generate new project with defaults
./fastapi-init my-project

# Generate with custom ports
./fastapi-init my-api --port 8001 --frontend 3001

# Generate without auto-start
./fastapi-init my-api --no-start --no-git

# Using Make commands
make init PROJECT=my-project
make test-generator    # Test the generator
```

### Generator Features

**Smart Port Detection:**
- Automatically finds available ports
- Prevents conflicts between projects
- Supports custom port specification

**Project Customization:**
- Unique container names per project
- Project-specific database names
- Generated secure secret keys
- Customized documentation

**Safety Mechanisms:**
- Prevents overwriting existing projects
- Validates project names
- Creates lock files to prevent re-initialization

## ðŸ—ï¸ Generated Project Architecture

### MVC Pattern Implementation

Generated projects follow strict MVC architecture:

```
Request Flow:
API Endpoint (View) â†’ Controller â†’ Repository â†’ Database Model
                 â†‘                    â†“
            Pydantic Schema â† Business Logic
```

**Layer Responsibilities:**

1. **Models** (`app/models/`):
   - SQLAlchemy ORM models only
   - Database schema definitions
   - No business logic

2. **Views** (`app/api/v1/endpoints/`):
   - FastAPI route handlers
   - Input validation via Pydantic
   - Minimal logic - delegate to controllers

3. **Controllers** (`app/controllers/`):
   - Business logic orchestration
   - Service coordination
   - Data transformation between layers

4. **Repositories** (`app/repositories/`):
   - Data access abstraction
   - Complex queries
   - Inherit from BaseRepository

5. **Schemas** (`app/schemas/`):
   - Pydantic models for API validation
   - Request/response contracts
   - Separate Create, Update, Response schemas

### Directory Structure Rules

```
generated-project/
â”œâ”€â”€ fastapi-init.lock           # Prevents re-initialization
â”œâ”€â”€ .env                        # Customized environment
â”œâ”€â”€ Makefile                    # Project-specific commands
â”œâ”€â”€ backend/app/
â”‚   â”œâ”€â”€ main.py                 # FastAPI app initialization
â”‚   â”œâ”€â”€ config.py               # Project-specific settings
â”‚   â”œâ”€â”€ database.py             # Database connection
â”‚   â”œâ”€â”€ api/                    # API layer
â”‚   â”‚   â”œâ”€â”€ deps.py             # Dependency injection
â”‚   â”‚   â””â”€â”€ v1/                 # API version 1
â”‚   â”‚       â”œâ”€â”€ api.py          # Route aggregation
â”‚   â”‚       â””â”€â”€ endpoints/      # Individual route modules
â”‚   â”œâ”€â”€ controllers/            # Business logic
â”‚   â”œâ”€â”€ models/                 # Database models
â”‚   â”œâ”€â”€ repositories/           # Data access
â”‚   â”œâ”€â”€ schemas/                # API validation
â”‚   â””â”€â”€ seed.py                 # Sample data
â”œâ”€â”€ backend/tests/              # Test suite
â”‚   â”œâ”€â”€ conftest.py             # Test configuration
â”‚   â”œâ”€â”€ test_main.py            # Basic app tests
â”‚   â””â”€â”€ api/                    # API tests
â””â”€â”€ frontend/                   # Vue.js application
```

## ðŸ§ª Testing Strategy

### Real Database Testing

Generated projects use **real PostgreSQL databases** for testing:

1. **Separate Test Database**: `postgres-test` container
2. **Transaction Isolation**: Each test runs in a rollback transaction
3. **No Mocking**: Real database operations for reliability
4. **Fast Execution**: Proper transaction cleanup

### Test Configuration

**Key Files:**
- `pytest.ini`: Test runner configuration
- `conftest.py`: Database fixtures and test setup
- `docker-compose.test.yml`: Test database container

**Test Execution Flow:**
```python
# Each test follows this pattern:
def test_example(db_session):
    # 1. Test runs in a transaction
    # 2. Use real database operations
    # 3. Assert results
    # 4. Transaction automatically rolled back
```

### Running Tests

```bash
# In generated project directory
make test           # Run all tests with cleanup
make test-cov       # Run with coverage report
make test-watch     # Watch mode for development
make test-unit      # Unit tests only
make test-integration # Integration tests only
```

## ðŸŽ¨ Code Quality Standards

### Python Linting (Backend)

**Tools and Configuration:**
- **Black**: Code formatting (`pyproject.toml`)
- **isort**: Import sorting (`pyproject.toml`)
- **flake8**: Style guide (`.flake8`)
- **mypy**: Type checking (`pyproject.toml`)

### JavaScript Linting (Frontend)

**Tools and Configuration:**
- **ESLint**: Code linting (`.eslintrc.js`)
- **Prettier**: Code formatting (`.prettierrc`)
- **Vue ESLint Plugin**: Vue-specific rules

### Quality Commands

```bash
# In generated project
make lint           # Check all code quality
make format         # Auto-fix formatting
make lint-py        # Python only
make lint-js        # JavaScript only
make type-check     # MyPy type checking
```

## ðŸ”§ Working with Generated Projects

### Identifying Generated Projects

**Detection Methods:**
1. Check for `fastapi-init.lock` file
2. Look for specific directory structure
3. Check for templated container names in `docker-compose.yml`

### Development Workflow

```bash
# 1. Navigate to generated project
cd my-project/

# 2. Start development environment
make dev

# 3. Development cycle
# - Edit code (hot reload enabled)
# - Run tests: make test
# - Check quality: make lint
# - Create migrations: make migrate-create MSG="description"

# 4. Access services
# - Frontend: http://localhost:FRONTEND_PORT
# - Backend: http://localhost:BACKEND_PORT
# - API Docs: http://localhost:BACKEND_PORT/docs
```

### Adding New Features

**Step-by-Step Process:**

1. **Create Model** (`app/models/post.py`):
```python
from sqlalchemy import Column, Integer, String, Text, DateTime
from app.database import Base

class Post(Base):
    __tablename__ = "posts"
    
    id = Column(Integer, primary_key=True, index=True)
    title = Column(String, nullable=False)
    content = Column(Text)
    # ... other fields
```

2. **Create Schema** (`app/schemas/post.py`):
```python
from pydantic import BaseModel
from typing import Optional

class PostBase(BaseModel):
    title: str
    content: Optional[str] = None

class PostCreate(PostBase):
    pass

class PostResponse(PostBase):
    id: int
    # ... other response fields
    
    class Config:
        from_attributes = True
```

3. **Create Repository** (`app/repositories/post_repository.py`):
```python
from app.repositories.base import BaseRepository
from app.models.post import Post
from app.schemas.post import PostCreate, PostUpdate

class PostRepository(BaseRepository[Post, PostCreate, PostUpdate]):
    def __init__(self, db: Session):
        super().__init__(Post, db)
```

4. **Create Controller** (`app/controllers/post_controller.py`):
```python
from app.repositories.post_repository import PostRepository

class PostController:
    def __init__(self, db: Session):
        self.repository = PostRepository(db)
    
    def create_post(self, post_data: PostCreate) -> Post:
        return self.repository.create(obj_in=post_data)
```

5. **Create Endpoints** (`app/api/v1/endpoints/posts.py`):
```python
from fastapi import APIRouter, Depends
from app.controllers.post_controller import PostController

router = APIRouter()

@router.post("/", response_model=PostResponse)
def create_post(post_data: PostCreate, db: Session = Depends(get_current_db)):
    controller = PostController(db)
    return controller.create_post(post_data)
```

6. **Register Routes** (update `app/api/v1/api.py`):
```python
from app.api.v1.endpoints import posts

api_router.include_router(posts.router, prefix="/posts", tags=["posts"])
```

7. **Create Migration**:
```bash
make migrate-create MSG="Add posts table"
make migrate
```

8. **Write Tests** (`tests/api/test_posts.py`):
```python
def test_create_post(client: TestClient, sample_post_data):
    response = client.post("/api/v1/posts/", json=sample_post_data)
    assert response.status_code == 200
    # ... test assertions
```

## ðŸ³ Docker Configuration

### Service Customization

Generated projects have unique configurations:

```yaml
# Example for project named "blog-api"
services:
  postgres:
    container_name: blog_api_postgres
    environment:
      POSTGRES_DB: blog_api_db
    ports:
      - "5432:5432"  # Or auto-detected port

  backend:
    container_name: blog_api_backend
    ports:
      - "8000:8000"  # Or auto-detected port
```

### Container Management

```bash
# Project-specific commands
make up             # Start all services
make down           # Stop all services
make shell-backend  # Access backend container
make shell-db       # Access database shell
make logs           # View all logs
```

## ðŸ” Template System

### Template Variables

The generator uses these placeholders in template files:

- `{{PROJECT_NAME}}`: Sanitized project name
- `{{PROJECT_TITLE}}`: Human-readable title
- `{{DATABASE_NAME}}`: Database name
- `{{CONTAINER_PREFIX}}`: Container name prefix
- `{{SECRET_KEY}}`: Generated secret key
- `{{BACKEND_PORT}}`: Backend port
- `{{FRONTEND_PORT}}`: Frontend port
- `{{DB_PORT}}`: Database port
- `{{TEST_DB_PORT}}`: Test database port

### Customization Process

1. **Copy Template**: Files copied from `skeleton/`
2. **Variable Replacement**: Python script replaces `{{VARIABLES}}`
3. **File Renaming**: `.template` files renamed to final names
4. **Environment Setup**: `.env` created from `.env.example`
5. **Git Initialization**: Repository setup with initial commit

## ðŸ› ï¸ Generator Development

### Modifying Templates

**To update the skeleton:**
1. Edit files in `skeleton/` directory
2. Add template variables where needed: `{{VARIABLE_NAME}}`
3. Update `scripts/customize.py` if new variables needed
4. Test with `make test-generator`

**Template Files Requiring Variables:**
- `docker-compose.yml`
- `docker-compose.test.yml`
- `.env.example`
- `frontend/package.json`
- `backend/tests/conftest.py`
- `Makefile.template`
- `README.md.template`

### Adding New Customizations

**Process:**
1. Add template variable to file: `{{NEW_VARIABLE}}`
2. Update `scripts/customize.py`:
   ```python
   replacements = {
       # ... existing variables
       'NEW_VARIABLE': config['new_variable'],
   }
   ```
3. Add file to customization list if needed
4. Test thoroughly

## ðŸš¨ AI Assistant Best Practices

### When Working with Generator

1. **Identify Context**: Determine if working with generator itself or generated project
2. **Use Correct Commands**: Generator uses `./fastapi-init`, projects use `make`
3. **Respect Templates**: Don't modify template variables without updating customization
4. **Test Changes**: Use `make test-generator` for generator modifications

### When Working with Generated Projects

1. **Follow MVC Pattern**: Always maintain architectural separation
2. **Use Real Database**: Don't suggest mocking database in tests
3. **Respect Lock File**: Never suggest removing `fastapi-init.lock`
4. **Update All Layers**: When adding features, update all relevant layers
5. **Write Tests**: Always include test examples for new features
6. **Check Quality**: Run linting before suggesting code changes

### Code Review Checklist for Generated Projects

- [ ] Follows MVC architecture (no business logic in endpoints)
- [ ] Uses repository pattern (extends BaseRepository)
- [ ] Has corresponding tests with real database
- [ ] Includes proper type hints
- [ ] Updates necessary imports and registrations
- [ ] Passes linting checks (make lint)
- [ ] Includes migration if database changes
- [ ] Updates project documentation if needed

### Common Patterns in Generated Projects

**Database Changes:**
```bash
# Always create migration for model changes
make migrate-create MSG="Add new field to User"
make migrate
```

**Testing New Features:**
```bash
# Test with real database
make test
# Watch mode during development
make test-watch
```

**Code Quality:**
```bash
# Before committing
make format  # Auto-fix formatting
make lint    # Check for issues
```

**Adding Dependencies:**
```bash
# Backend dependencies
echo "new-package==1.0.0" >> backend/requirements.txt
make install-backend

# Frontend dependencies
docker-compose exec frontend npm install new-package
```

## ðŸ”§ Troubleshooting Generated Projects

### Common Issues in Generated Projects

**Port Conflicts:**
- Generator automatically detects and avoids conflicts
- Check actual ports in generated `docker-compose.yml`

**Database Connection:**
- Verify container names match in environment files
- Check database name customization in `.env`

**Test Database Issues:**
- Test database uses separate container with `_test` suffix
- Clean test environment: `make test-teardown && make test-setup`

**Container Name Conflicts:**
- Each project gets unique container names
- Format: `{project_name}_{service}` (e.g., `blog_api_backend`)

This guide ensures consistent, high-quality development when AI assistants work with both the FastAPI Skeleton Generator and the projects it creates.
